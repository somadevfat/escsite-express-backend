# 変更概要（2025-08-12）

- 目的: `express-rest-api` から Swagger 提供を切り離し、`config`（Swagger UI + Nginx）で提供。同一オリジン化で CORS を不要化し、OpenAPI の不整合を是正。

## 1) express-rest-api（アプリ本体）
- Swagger 提供コードを削除
  - 削除: `src/config/swagger.ts`
  - 変更: `src/main.ts` から `setupSwagger` と関連ログを除去
- ポート変更: 既定 `8080` → `18081`
- 依存整理: `swagger-ui-express`, `yamljs`, `@types/*` を `package.json` から削除

## 2) config（インフラ・ドキュメント提供）
- Swagger UI（Nginx）で `/api` を Express へリバースプロキシ
  - 追加: `server/nginx/swagger-ui/templates/default.conf.template`
    - `location /api/ { proxy_pass http://host.docker.internal:18081/api/; ... }`
  - 変更: `docker-compose.yml`
    - `lh_react_swagger-ui` にテンプレートをマウント
    - `extra_hosts: ["host.docker.internal:host-gateway"]` を追加
- OpenAPI の `servers` を相対パス化
  - 変更: `docs/openapi.yml` → `servers.default: /api`

## 3) OpenAPI 仕様の整合性修正
- `PUT /items/{itemId}` にパスパラメータ定義を追加
  - 変更: `docs/paths/items/itemId/index.yml`
- パラメータ名の大小文字不一致を解消
  - 変更: `docs/params/ItemId.yml` → `name: itemId`（小文字に統一）

## 4) Git 管理
- ルート単一リポジトリに統合（`config` と `express-rest-api`）
  - 追加: ルート `.gitignore`（データ/ログ/`node_modules` 等を除外）
  - リモート: `somadevfat/escsite-express-backend` に `main` / `develop` / `feature/nginx-proxy-express` を push

---

## 実行方法（再掲）
- アプリ起動（:18081）
  - `cd express-rest-api && npm run dev`
- Swagger UI（:8888）
  - `docker compose -f config/docker-compose.yml up -d lh_react_swagger-ui`
- 動作確認
  - `curl 'http://localhost:8888/api/items?limit=20&page=1'`
  - `curl 'http://localhost:8888/api/items/2'`
  - `curl -X PUT 'http://localhost:8888/api/items/2' -H 'Content-Type: application/json' --data-raw '{"name":"商品","price":120,"content":"商品詳細！"}'`

## 補足
- 同一オリジン（:8888配下）で `/api` を提供するため、ブラウザCORSは不要。
- 404 の場合、`itemId` に実在 ID（例: `1..5`）を指定。
